---
agent: agent
description: "ORDER를 분석하여 구조화된 작업 계획서(PLAN) 작성"
---

사용자의 직접 명령 또는 외부 문서(기획서, 티켓 등)를 분석하여 구조화된 PLAN 문서를 생성합니다.

## 목적

사용자의 요청사항을 체계적으로 분석하고, 구현 가능한 단계별 작업 계획으로 변환하여 문서화합니다. PLAN은 execute_plan 커맨드의 실행 기준이 됩니다.

## 트리거

- 사용자가 새로운 기능 개발, 버그 수정 등의 작업 계획서 작성을 요청할 때
- 외부 기획서, 요구사항 문서가 `/docs/planning/` 폴더에 추가되었을 때
- Jira/GitHub Issue/Linear 내용을 PLAN으로 변환할 때
- 사용자가 외부 문서 기반 PLAN 작성을 요청할 때

## 입력 모드

사용자의 명령을 분석하여 두 가지 모드 중 하나로 진행합니다.

| 모드 | 입력 | 판별 기준 | 특징 |
|------|------|-----------|------|
| **Direct** | 사용자 직접 요청 (ORDER) | 구체적 기능/작업 지시, 외부 문서 언급 없음 | 대화형으로 요구사항 확인 |
| **Document** | 외부 첨부 문서 (ORDER) | 문서 경로/링크 제공, planning 폴더 참조, 외부 출처 언급 | 문서 분석 후 변환 |

### 지원 입력 형식 (Document 모드)

| 유형 | 예시 | 처리 방법 |
|------|------|-----------|
| 이슈 트래커 | Jira 티켓, GitHub Issue, Linear | 링크 및 내용 복사 |
| 문서 | 기획서 (PDF, Markdown, Notion) | 전문 또는 핵심 요약 |
| 메시지 | 슬랙 스레드, 이메일 요청 | 요구사항 추출 |
| 회의록 | 미팅 노트, 요구사항 정리 | 액션 아이템 추출 |

## 결과물

### 파일 경로

```text
/docs/current_sprint/planMMDDNN.md
```

> 폴더가 없으면 자동 생성합니다.
> 파일명 규칙: `plan` + `월(MM)` + `일(DD)` + `순번(NN)` + `.md`
> 참고: [CLAUDE.md - 파일 네이밍 규칙](../../CLAUDE.md#3-파일-네이밍-규칙)

### 파일 형식

```markdown
## 1. 개요
- 날짜: YYYY-MM-DD (Asia/Tokyo)
- Commit: 현재 main 브랜치 commit ID
- 오더: (사용자 프롬프트 원문)
- 요약: (핵심 3줄 이내)
- 입력 모드: Direct | Document

## 2. 목표 및 배경
(상세 설명)

## 3. 문제점 분석 (해당 시)
오더에 심각한 문제가 있고 대안이 존재하는 경우:
-> 여기까지만 작성하고 대안 제시 후 마무리

## 4. 변경 범위

### 4.1 산출물
- 산출물 목록

### 4.2 변경 파일
| 상태 | 경로 | 설명 |
|------|------|------|
| A | /path/to/new.ts | 신규 컴포넌트 |
| M | /path/to/edit.ts | 함수 추가 |
| D | /path/to/old.ts | 미사용 파일 삭제 |

## 5. 구현 계획
(설계 의도 및 작업 단계)

### Phase 1: [단계명]
- 작업 항목
- 테스트 확인

### Phase 2: [단계명]
...

## 6. 테스트

### 자동 테스트 (AI)
| 항목 | 방법 | 예상 결과 |
|------|------|----------|
| ... | ... | ... |

### 수동 테스트 (사용자)
| 항목 | 방법 | 예상 결과 |
|------|------|----------|
| ... | ... | ... |

## 7. 주의사항
- 리스크: ...
- 롤백 방법: ...
- Known Issues: ...

## 8. 원본 문서 (Document 모드 전용)

### 문서 정보
- 출처: (Jira, Notion, 이메일 등)
- 작성자: (원작성자)
- 작성일: YYYY-MM-DD
- 링크: (해당 시)

### 원본 내용
(원본 문서 전문 또는 요약)
```

## 실행 순서

### Phase 0: 모드 판별

1. 사용자 입력 분석
   - 외부 문서 경로/링크가 포함되어 있는가?
   - `/docs/planning/` 폴더에 새 문서가 있는가?
   - 이슈 트래커(Jira, GitHub Issue 등) 참조가 있는가?

2. 모드 결정
   - 위 조건 중 하나라도 해당 → **Document 모드**
   - 해당 없음 → **Direct 모드**

### Phase 1: 현재 상태 파악

1. Git 상태 확인
   ```bash
   git status
   git log -1 --oneline
   ```

2. 프로젝트 구조 확인
   - `/docs/ARCHITECTURE.md` 읽기
   - `/docs/FRONTEND_STRUCTURE.md` 또는 `/docs/BACKEND_STRUCTURE.md` 읽기
   - `/docs/FRONTEND_ROUTES.md`, `/docs/BACKEND_API.md` (해당 시)
   - 필요 시 소스 코드 구조 탐색

3. TODO 확인
   - `/docs/TODO.md` 확인
   - 관련 항목이 있으면 PLAN에 반영

4. 확인 사항
   - 기존 폴더 구조 및 역할 준수
   - 불필요한 중복 방지
   - 확장성 고려
   - 현재 진행 중인 Sprint와의 충돌 여부

### Phase 2: 요구사항 분석

#### Direct 모드

1. 사용자 ORDER 분석
   - 핵심 요구사항 추출
   - 불명확한 부분 질문으로 확인

2. 문제점 검토
   - 실현 불가능한 요구사항
   - 아키텍처 위반 가능성
   - 기술적 제약사항

3. 문제 발견 시
   - 대안 제시 후 PLAN 작성 중단
   - 사용자 확인 후 재진행

#### Document 모드

1. 외부 문서 수집
   ```bash
   ls /docs/planning/
   ```
   - `/docs/planning/` 폴더 내 모든 문서 읽기
   - 문서 형식 파악 (Markdown, PDF, 텍스트 등)

2. 핵심 요구사항 추출
   - 목표 및 배경
   - 기능 요구사항
   - 비기능 요구사항 (성능, 보안 등)
   - 제약사항
   - 우선순위

3. 불명확 사항 확인
   - 요구사항이 불명확한 부분 정리
   - 기술적 선택이 필요한 부분
   - 우선순위가 불분명한 부분
   - 사용자에게 선택지 포함하여 확인 요청

### Phase 3: PLAN 작성

1. 파일명 결정
   - 현재 날짜 기준 (Asia/Tokyo)
   - `/docs/current_sprint/` 폴더 내 동일 날짜 파일 확인
   - 순번(NN) 결정 (01, 02, ...)

2. PLAN 문서 작성
   - 표준 템플릿 사용
   - 추상화 수준 유지 (구현 코드 X, 인터페이스/시그니처 O)
   - Phase별 작업 단계 명확히 구분
   - 요구사항 → Phase별 작업으로 매핑
   - 우선순위 설정 (P0-P3)
   - 의존성 파악

3. 변경 범위 명시
   - 신규 파일 (A)
   - 수정 파일 (M)
   - 삭제 파일 (D)

4. Document 모드 추가 작업
   - "8. 원본 문서" 섹션 작성
   - 출처, 작성자, 링크 명시
   - 원본 내용 전문 또는 요약 포함

### Phase 4: 검증 및 승인 요청

1. PLAN 자체 검증
   - 모든 요구사항 포함 여부
   - Phase 구분의 명확성
   - 테스트 계획 완성도
   - 프로젝트 구조와 일관성 확인
   - 실현 가능성 검토

2. 사용자 승인 요청
   - PLAN 내용 설명
   - 질문사항 확인
   - Document 모드: 원본 문서와의 차이점, 해석이 필요했던 부분 공유

## 주의사항

- **추상화**: 구현 코드 없이 인터페이스/시그니처 수준으로 기술
- **구조 참조**: `/docs/ARCHITECTURE.md` 및 STRUCTURE 문서 확인, 중복 제거
- **TODO 반영**: `/docs/TODO.md` 확인, 관련 항목 PLAN에 포함
- **사용자 승인**: AI는 사용자 승인 없이 작업을 실행하지 않음
- **문제 발견**: 오더에 문제가 있으면 즉시 중단하고 대안 제시
- **우선순위**: P0-P3 레벨 명시 ([CLAUDE.md 참조](../../CLAUDE.md#11-우선순위-정의))
- **원본 보존**: Document 모드 시 원본 외부 문서는 PLAN 하단에 반드시 보존
- **해석 확인**: 해석이 불명확한 부분은 반드시 사용자에게 확인
- **링크 유지**: 외부 링크(Jira, Notion 등)는 PLAN에 명시

## 다음 단계

PLAN 작성 및 승인 완료 후:
1. `execute_plan` 커맨드로 구현 시작
2. 구현 중 계획 변경 필요 시 PLAN 업데이트
3. 완료 후 `finish_order` 커맨드로 정리
4. Document 모드: `/docs/planning/` 폴더의 원본 문서는 유지, Sprint 종료 시 `finish_sprint`에서 정리
